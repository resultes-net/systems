**************************************
**BEGIN type1535.dck
**************************************

*****************************************
** Contact person : Mikel Arenas
** Creation date  : 20.06.2025
** Last changes   :
*****************************************

***********************************
** Pit storage for resultes. Based on swisstes
***********************************

******************************************************************************************
** outputs to energy balance in kWh
** Following this naming standard : qSysIn_name, qSysOut_name, elSysIn_name, elSysOut_name
******************************************************************************************

***********************************
** inputs from hydraulic solver
***********************************

EQUATIONS #
T13     = @temp(HotIn) !$TTeeStrat_pitStoreTes! Hardcoded from hydraulic
M13     = $ModePP13 * ABS(@mfr(HotIn)) !$ModePP13 * ABS($MpitStoreTesDpL99_5_A)! Hardcoded from hydraulic

T31     = @revtemp(HotOut) !$TpitStoreTes_Tee3! Hardcoded from hydraulic
M31     = $ModePP31 * ABS(@mfr(HotIn)) !$ModePP31 * ABS($MpitStoreTesDpL99_5_A)! Hardcoded from hydraulic

T23     = @temp(MediumIn) !$TValStrat_pitStore! Hardcoded from hydraulic
M23     = $ModePP23 * ABS(@mfr(MediumIn)) !$ModePP23 * ABS($MpitStoreTesDpL50_1_A) ! Hardcoded from hydraulic

***********************************
** outputs to hydraulic solver
***********************************

EQUATIONS #
@temp(HotOut) = $ModePP13*TOutPP13 + $ModePP31*TOutPP31
@temp(MediumOut) = TOutPP23

**********************
** port definitions **
**********************

EQUATIONS #
TInPP13        = T13        ! 1  (C) Inlet Temperature  for Port-13
MfrInPP13      = M13        ! 2  (kg/hr) Inlet Flowrate for Port-13
TInPP23        = T23        ! 3  (C) Inlet Temperature  for Port-23
MfrInPP23      = M23        ! 4  (kg/hr) Inlet Flowrate for Port-23
TInPP31        = T31        ! 5  (C) Inlet Temperature  for Port-31
MfrInPP31      = M31        ! 6  (kg/hr) Inlet Flowrate for Port-31




! connection 1: node 1,
! connection 2: node 5,
! connection 3: node 10,
! port pair: PP12 is a massflow from con1 to con3, PP13 is a massflow from con1 to con3
! here a sketch of the PTES with its real connections
!   _________________________________________________________
!   \                                                       /
!    \                                     connection 1  ----- temperature of TherStat1 (TTherStat1)
!     \                                                   /
!      \                                                 /
!       \                                               /
!        \                                             /
!         \                           connection 2  ----- temperature of TherStat2 (TTherStat2)
!          \                                         /
!           \                                       /
!            \                                     /
!             \                                   /
!              \                 connection 3  ----- temperature of TherStat3 (TTherStat3)
!               \                               /
!                -------------------------------


** storage definition (for type 1301 and 1535)
CONSTANTS 4
StVolume = 30000            !(m3) volume of storage
StHeight = 30               !(m) height of storage
SlAng = 60                  !(ï¿½) angle between the top surface and the side wall
StNodes = 10

** calculating the radius ratio needed by this type through the slope angle
CONSTANTS 7
h = StHeight                ! calculation variable
V = StVolume                ! calculation variable
alpha = SlAng               ! calculation variable
dR = StHeight / tan(SlAng)  !(m) Difference between upper radius and lower radius
LoRad = -(h^2*$PI^(1/2) - (-(h*($PI*h^3 - 12*V*tan(alpha)^2))/3)^(1/2))/(2*h*$PI^(1/2)*tan(alpha))     !equation solved with matlab to find the lower/bottom radius of the pit storage
UpRad = LoRad + dR
Ratio = UpRad/LoRad

** standardization of parameters for every node / layer
CONSTANTS 3
IniT        = 90       ! (C) initial temperature of all the nodes
LoCoe       = 3        ! (kJ/hr.m^2.K) loss coefficient for all the nodes + top and bottom
FlueOLCoe   = 0        ! (kJ/hr.m^2.K) flue overall loss coefficient for all the nodes

******************************************************************************************
**predefinition of parameters and inputs for type 1535
CONSTANTS #
LUfile       = -1           ! 1  (-) LU for Data File, if -1 then you have to define the parameters after parameter 6, if >0, then you need a DataFile to define the mentioned parameters - for more information see the example project in trnsys studio
NTankN       = StNodes      ! 2  (-) Number of Tank Nodes
!NPorts       = 10           ! 3  (-) Number of Ports
NPorts       = 3           ! 3  (-) Number of Port Pairs
NImmHX       = 0            ! 4  (-) Number of Immersed Heat Exchangers
NMiscHF      = 0            ! 5  (-) Number of Miscellaneous Heat Flows
NTherSt      = 3            ! 6  (-) Number of Thermostats
TankV        = StVolume     ! 7  (m3) Tank Volume
TankH        = StHeight     ! 8  (m) Tank Height
RatRad       = Ratio        ! 9  (-) Ratio of Tank Radii
FlSpeHeat    = $CPWAT       ! 10 (kJ/kg.K) Specific Heat
FlDen        = $RHOWAT      ! 11 (kg/m3) Fluid Density
FlThCond     = 2.14         ! 12 (kJ/hr.m.K) Fluid Thermal Conductivity
FlVisc       = 3.21         ! 13 (kg/m.hr) Fluid Viscosity
FlThExpCoe   = 0.00026      ! 14 (1/K) Fluid Thermal Expansion Coefficient
IniTN1       = IniT         ! 15 (C) Initial temperature of node-1
IniTN2       = IniT         ! 16 (C) Initial temperature of node-2
IniTN3       = IniT         ! 17 (C) Initial temperature of node-3
IniTN4       = IniT         ! 18 (C) Initial temperature of node-4
IniTN5       = IniT         ! 19 (C) Initial temperature of node-5
IniTN6       = IniT         ! 19 (C) Initial temperature of node-6
IniTN7       = IniT         ! 19 (C) Initial temperature of node-7
IniTN8       = IniT         ! 19 (C) Initial temperature of node-8
IniTN9       = IniT         ! 19 (C) Initial temperature of node-9
IniTN10      = IniT         ! 19 (C) Initial temperature of node-10
ToLoCoe      = 1            ! 20 (kJ/hr.m^2.K) Top Loss Coefficient
EdLoCoeN1    = LoCoe        ! 21 (kJ/hr.m^2.K) Edge Loss Coefficient for Node-1
EdLoCoeN2    = LoCoe        ! 22 (kJ/hr.m^2.K) Edge Loss Coefficient for Node-2
EdLoCoeN3    = LoCoe        ! 23 (kJ/hr.m^2.K) Edge Loss Coefficient for Node-3
EdLoCoeN4    = LoCoe        ! 24 (kJ/hr.m^2.K) Edge Loss Coefficient for Node-4
EdLoCoeN5    = LoCoe        ! 25 (kJ/hr.m^2.K) Edge Loss Coefficient for Node-5
EdLoCoeN6    = LoCoe        ! 25 (kJ/hr.m^2.K) Edge Loss Coefficient for Node-6
EdLoCoeN7    = LoCoe        ! 25 (kJ/hr.m^2.K) Edge Loss Coefficient for Node-7
EdLoCoeN8    = LoCoe        ! 25 (kJ/hr.m^2.K) Edge Loss Coefficient for Node-8
EdLoCoeN9    = LoCoe        ! 25 (kJ/hr.m^2.K) Edge Loss Coefficient for Node-9
EdLoCoeN10   = LoCoe        ! 25 (kJ/hr.m^2.K) Edge Loss Coefficient for Node-10
BoLoCoe      = LoCoe        ! 26 (kJ/hr.m^2.K) Bottom Loss Coefficient
AdTherCond   = 0            ! 27 (kJ/hr.m.K) Additional Thermal Conductivity
! connection 1: node 1, connection 2: node 17, connection 3: node 33, connection 4: node 50
! port pair: PP43 is a massflow from con4 to con3, PP34 is a massflow from con3 to con4

PP13InM        = 1            ! 28 (-) Port Pair 12 Inlet Mode
PP13EnN        = 1            ! 29 (-) Port Pair 12 Entry Node
PP13ExN        = 10           ! 30 (-) Port Pair 12 Exit Node

PP23InM        = 1            ! 31 (-) Port Pair 13 Inlet Mode
PP23EnN        = 5           ! 32 (-) Port Pair 13 Entry Node
PP23ExN        = 10           ! 33 (-) Port Pair 13 Exit Node

PP31InM        = 1            ! 31 (-) Port Pair 14 Inlet Mode
PP31EnN        = 5           ! 32 (-) Port Pair 14 Entry Node
PP31ExN        = 1            ! 33 (-) Port Pair 14 Exit Node


FlueOLCoeN1   = FlueOLCoe    ! 34 (kJ/hr.K) Flue Overall Loss Coefficient for Node-1
FlueOLCoeN2   = FlueOLCoe    ! 35 (kJ/hr.K) Flue Overall Loss Coefficient for Node-2
FlueOLCoeN3   = FlueOLCoe    ! 36 (kJ/hr.K) Flue Overall Loss Coefficient for Node-3
FlueOLCoeN4   = FlueOLCoe    ! 37 (kJ/hr.K) Flue Overall Loss Coefficient for Node-4
FlueOLCoeN5   = FlueOLCoe    ! 38 (kJ/hr.K) Flue Overall Loss Coefficient for Node-5
FlueOLCoeN6   = FlueOLCoe    ! 38 (kJ/hr.K) Flue Overall Loss Coefficient for Node-6
FlueOLCoeN7   = FlueOLCoe    ! 38 (kJ/hr.K) Flue Overall Loss Coefficient for Node-7
FlueOLCoeN8   = FlueOLCoe    ! 38 (kJ/hr.K) Flue Overall Loss Coefficient for Node-8
FlueOLCoeN9   = FlueOLCoe    ! 38 (kJ/hr.K) Flue Overall Loss Coefficient for Node-9
FlueOLCoeN10  = FlueOLCoe    ! 38 (kJ/hr.K) Flue Overall Loss Coefficient for Node-10
NTherStat1 = 1              ! (-) Node position of thermostat-1
NTherStat2 = 5             ! (-) Node position of thermostat-2
NTherStat3 = 10             ! (-) Node position of thermostat-3


EQUATIONS #
TToLo        = EffLoTTop    ! 5  (C) Top Loss Temperature
TEdLo1       = EffLoTEdN1   ! 6  (C) Edge Loss Temperature for Node-1
TEdLo2       = EffLoTEdN2   ! 7  (C) Edge Loss Temperature for Node-2
TEdLo3       = EffLoTEdN3   ! 8  (C) Edge Loss Temperature for Node-3
TEdLo4       = EffLoTEdN4   ! 9  (C) Edge Loss Temperature for Node-4
TEdLo5       = EffLoTEdN5   ! 10 (C) Edge Loss Temperature for Node-5
TEdLo6       = EffLoTEdN6   ! 10 (C) Edge Loss Temperature for Node-6
TEdLo7       = EffLoTEdN7   ! 10 (C) Edge Loss Temperature for Node-7
TEdLo8       = EffLoTEdN8   ! 10 (C) Edge Loss Temperature for Node-8
TEdLo9       = EffLoTEdN9   ! 10 (C) Edge Loss Temperature for Node-9
TEdLo10      = EffLoTEdN10  ! 10 (C) Edge Loss Temperature for Node-10
TBoLo        = EffLoTBot    ! 11 (C) Bottom Loss Temperature
TGasFlue     = 20           ! 12 (C) Gas Flue Temperature
MfrInvMix    = -100         ! 13 (kg/hr) Inversion Mixing Flowrate
AuxHeInpN1   = 0!HeTrN1       ! 14 (kJ/hr) Auxiliary Heat Input for Node-1
AuxHeInpN2   = 0!HeTrN2       ! 15 (kJ/hr) Auxiliary Heat Input for Node-2
AuxHeInpN3   = 0!HeTrN3       ! 16 (kJ/hr) Auxiliary Heat Input for Node-3
AuxHeInpN4   = 0!HeTrN4       ! 17 (kJ/hr) Auxiliary Heat Input for Node-4
AuxHeInpN5   = 0!HeTrN5       ! 18 (kJ/hr) Auxiliary Heat Input for Node-5
AuxHeInpN6   = 0!HeTrN6       ! 18 (kJ/hr) Auxiliary Heat Input for Node-6
AuxHeInpN7   = 0!HeTrN7       ! 18 (kJ/hr) Auxiliary Heat Input for Node-7
AuxHeInpN8   = 0!HeTrN8       ! 18 (kJ/hr) Auxiliary Heat Input for Node-8
AuxHeInpN9   = 0!HeTrN9       ! 18 (kJ/hr) Auxiliary Heat Input for Node-9
AuxHeInpN10  = 0!HeTrN10      ! 18 (kJ/hr) Auxiliary Heat Input for Node-10


UNIT 319 TYPE 1535   ! truncated cone tank model
PARAMETERS #
LUfile
NTankN
NPorts
NImmHX
NMiscHF
NTherSt
TankV
TankH
RatRad
FlSpeHeat
FlDen
FlThCond
FlVisc
FlThExpCoe
IniTN1
IniTN2
IniTN3
IniTN4
IniTN5
IniTN6
IniTN7
IniTN8
IniTN9
IniTN10
ToLoCoe
EdLoCoeN1
EdLoCoeN2
EdLoCoeN3
EdLoCoeN4
EdLoCoeN5
EdLoCoeN6
EdLoCoeN7
EdLoCoeN8
EdLoCoeN9
EdLoCoeN10
BoLoCoe
AdTherCond
!PP12InM
!PP12EnN
!PP12ExN
!PP13InM
!PP13EnN
!PP13ExN
!PP14InM
!PP14EnN
!PP14ExN
!PP34InM
!PP34EnN
!PP34ExN
!PP21InM
!PP21EnN
!PP21ExN
!PP31InM
!PP31EnN
!PP31ExN
!PP41InM
!PP41EnN
!PP41ExN
!PP32InM
!PP32EnN
!PP32ExN
!PP42InM
!PP42EnN
!PP42ExN
!PP43InM
!PP43EnN
!PP43ExN
PP13InM
PP13EnN
PP13ExN
PP23InM
PP23EnN
PP23ExN
PP31InM
PP31EnN
PP31ExN
FlueOLCoeN1
FlueOLCoeN2
FlueOLCoeN3
FlueOLCoeN4
FlueOLCoeN5
FlueOLCoeN6
FlueOLCoeN7
FlueOLCoeN8
FlueOLCoeN9
FlueOLCoeN10
NTherStat1
NTherStat2
NTherStat3

INPUTS #
TInPP13
MfrInPP13
TInPP23
MfrInPP23
TInPP31
MfrInPP31

TToLo

TEdLo1
TEdLo2
TEdLo3
TEdLo4
TEdLo5
TEdLo6
TEdLo7
TEdLo8
TEdLo9
TEdLo10

TBoLo
TGasFlue
MfrInvMix

AuxHeInpN1
AuxHeInpN2
AuxHeInpN3
AuxHeInpN4
AuxHeInpN5
AuxHeInpN6
AuxHeInpN7
AuxHeInpN8
AuxHeInpN9
AuxHeInpN10
*** INITIAL INPUT Values
!20 0 20 0 20 0 20 0 20 0 20 0 20 0 20 0 20 0 20 0 !Port inputs
20 0 20 0 20 0  !Port inputs
20   20 20 20 20 20 20 20 20 20 20    !temp values (losses and gas flue temp)
0 0 0   0 0 0 0 0 0 0 0 0 0  ! inversion mixing flowrate and aux values


** OUTPUTS
EQUATIONS #
TOutPP13   =    [319,1]    ! 1  (C) Temperature  at Outlet-13
MfrOutPP13 =    [319,2]    ! 2  (kg/hr) Flowrate at Outlet-13
TOutPP23   =    [319,3]    ! 3  (C) Temperature  at Outlet-23
MfrOutPP23 =    [319,4]    ! 4  (kg/hr) Flowrate at Outlet-23
TOutPP31   =    [319,5]    ! 5  (C) Temperature  at Outlet-31
MfrOutPP31 =    [319,6]    ! 6  (kg/hr) Flowrate at Outlet-31


TAvgTank =    [319,	7]      ! 7 (C) Average Tank Temperature
QDis   =    [319,	8]      ! 8 (kJ/hr) Energy Delivery Rate
QDis_kW = QDis/3600

Q13 =    [319,	9]     ! 9 (kJ/hr) Energy Delivered to Port13
Q23 =    [319,	10]     ! 10 (kJ/hr) Energy Delivered to Port23
Q31 =    [319,	11]     ! 11 (kJ/hr) Energy Delivered to Port31

Q13_kW = Q13/3600
Q23_kW = Q23/3600
Q31_kW = Q31/3600


QLossesTo = [319,	12]     ! 19 (kJ/hr) Top Losses
QLossesEd = [319,	13]     ! 20 (kJ/hr) Edge Losses
QLossesBo = [319,	14]     ! 21 (kJ/hr) Bottom Losses
QLosses   =     [319,	15]     ! 22 (kJ/hr) Total Tank Losses
QLosses_kW = QLosses/3600

QLossesGas =   [319,	16]     ! 23 (kJ/hr) Gas Flue Losses

QAux =      [319,	17]     ! 24 (kJ/hr) Auxiliary Heating Rate
QMis =      [319,	18]     ! 25 (kJ/hr) Miscellaneous Energy
QAccum =   [319,	19]     ! 26 (kJ/hr) Tank Energy Storage Rate
QHx =       [319,	20]     ! 27 (kJ/hr) HX Heat Transfer Rate

QAux_kW = QAux/3600
QMis_kW = QMis/3600
QAccum_kW = QAccum/3600
QHx_kW = QHx/3600
QImb_kW = -(Q13_kW + Q23_kW + Q31_kW) - QLosses_kW - QAccum_kW



TankEnBalErr =[319,	21]     ! 28 (%) Tank Energy Balance Error (base 100)

TTherStat1 =  [319,	22]     ! 29 (C) Thermostat1 Temperature
TTherStat2 =  [319,	23]     ! 30 (C) Thermostat2 Temperature
TTherStat3 =  [319,	24]     ! 31 (C) Thermostat3 Temperature

TTankN1  =    [319, 25]     ! 32 (C) Tank Nodal Temperature-1
TTankN2  =    [319, 26]     ! 33 (C) Tank Nodal Temperature-2
TTankN3  =    [319, 27]     ! 34 (C) Tank Nodal Temperature-3
TTankN4  =    [319, 28]     ! 35 (C) Tank Nodal Temperature-4
TTankN5  =    [319, 29]     ! 36 (C) Tank Nodal Temperature-5
TTankN6  =    [319, 30]     ! 37 (C) Tank Nodal Temperature-6
TTankN7  =    [319, 31]     ! 38 (C) Tank Nodal Temperature-7
TTankN8  =    [319, 32]     ! 39 (C) Tank Nodal Temperature-8
TTankN9  =    [319, 33]     ! 40 (C) Tank Nodal Temperature-9
TTankN10 =    [319, 34]     ! 41 (C) Tank Nodal Temperature-10

! this part of the code calculates the percentage of the storage, which still has the temperature to feed in directly into the district heating
EQUATIONS #
TDef = 85                   ! (ï¿½C) defined temperature for feeding the district heating directly
HLay = StHeight / StNodes   ! (m) height per layer
RadL1 = UpRad - HLay/(2*tan(SlAng)) ! (m) average radius of layer 1
dRadL = dR / StNodes                ! (m) difference of of the radius of layer N and layer N-1
! first part of following equations is to look, if the layer has a temperature below or above the defined temp for DH
! second part of the equation is to calculate the volumetric percentage of the layer to the whole storage - it is assumed that one layer is cylindrical
PerN1  = GE(TTankN1 ,TDef) * (HLay*(RadL1-0 *dRadL)^2*$PI/StVolume)
PerN2  = GE(TTankN2 ,TDef) * (HLay*(RadL1-1 *dRadL)^2*$PI/StVolume)
PerN3  = GE(TTankN3 ,TDef) * (HLay*(RadL1-2 *dRadL)^2*$PI/StVolume)
PerN4  = GE(TTankN4 ,TDef) * (HLay*(RadL1-3 *dRadL)^2*$PI/StVolume)
PerN5  = GE(TTankN5 ,TDef) * (HLay*(RadL1-4 *dRadL)^2*$PI/StVolume)
PerN6  = GE(TTankN6 ,TDef) * (HLay*(RadL1-5 *dRadL)^2*$PI/StVolume)
PerN7  = GE(TTankN7 ,TDef) * (HLay*(RadL1-6 *dRadL)^2*$PI/StVolume)
PerN8  = GE(TTankN8 ,TDef) * (HLay*(RadL1-7 *dRadL)^2*$PI/StVolume)
PerN9  = GE(TTankN9 ,TDef) * (HLay*(RadL1-8 *dRadL)^2*$PI/StVolume)
PerN10 = GE(TTankN10,TDef) * (HLay*(RadL1-9 *dRadL)^2*$PI/StVolume)

HotWatProportion = PerN1+PerN2+PerN3+PerN4+PerN5+PerN6+PerN7+PerN8+PerN9+PerN10

***********************************
** Hourly printer
***********************************
CONSTANTS 1
unitHourlyPit = 33

ASSIGN    temp\PTES_HR.Prt    unitHourlyPit

UNIT 34 TYPE 46		! Printegrator Monthly Values for System
PARAMETERS #
unitHourlyPit		! 1: Logical unit number, -
-1            		! 2: Logical unit for monthly summaries, -
1             		! 3: Relative or absolute start time. 0: print at time intervals relative to the simulation start time. 1: print at absolute time intervals. No effect for monthly integrations
1             		! 4: Printing & integrating interval, h. -1 for monthly integration
7             		! 5: Number of inputs to avoid integration, -
1             		! 6: Output number to avoid integration
2             		! 7: Output number to avoid integration
3             		! 8: Output number to avoid integration
4             		! 9: Output number to avoid integration
8             		! 10: Output number to avoid integration
9             		! 11: Output number to avoid integration
10             		! 12: Output number to avoid integration
INPUTS #
T13 T31 T23 TAvgTank M13 M31 M23 TTherStat1 TTherStat2 TTherStat3
QLosses_kW Q13_kW Q23_kW Q31_kW QDis_kW QAccum_kW
**
T13 T31 T23 TAvgTank M13 M31 M23 TTherStat1 TTherStat2 TTherStat3
QLosses_kW Q13_kW Q23_kW Q31_kW QDis_kW QAccum_kW

***********************************
** Monthly printer
***********************************
CONSTANTS 1
unitMonthlyPit = 35

ASSIGN    temp\PTES_MO.Prt    unitMonthlyPit

UNIT 34 TYPE 46		! Printegrator Monthly Values for System
PARAMETERS #
unitMonthlyPit		! 1: Logical unit number, -
-1            		! 2: Logical unit for monthly summaries, -
1             		! 3: Relative or absolute start time. 0: print at time intervals relative to the simulation start time. 1: print at absolute time intervals. No effect for monthly integrations
-1             		! 4: Printing & integrating interval, h. -1 for monthly integration
0             		! 5: Number of inputs to avoid integration, -
INPUTS #
QLosses_kW Q13_kW Q23_kW Q31_kW QDis_kW QAccum_kW QImb_kW
**
QLosses_kW Q13_kW Q23_kW Q31_kW QDis_kW QAccum_kW QImb_kW

*************************************
** Online Plotter
*************************************
UNIT 501 TYPE 65     ! Online Plotter HX
PARAMETERS 12
#     ! 1 Nb. of left-axis variables
#     ! 2 Nb. of right-axis variables
0     ! 3 Left axis minimum
100     ! 4 Left axis maximum -
-10000     ! 5 Right axis minimum
10000     ! 6 Right axis maximum
$nPlotsPerSim     ! 7 Number of plots per simulation
12     ! 8 X-axis gridpoints
1     ! 9 Shut off Online w/o removing
-1     ! 10 Logical unit for output file
0     ! 11 Output file units
0     ! 12 Output file delimiter
INPUTS #
TTankN1 TTankN5 TTankN10 | QAccum_kW QDis_kW QLosses_kW QStore HotWatProportion
TTankN1 TTankN5 TTankN10  | QAccum_kW QDis_kW QLosses_kW QStore HotWatProportion
LABELS  3
Temperatures
EnergyFlows
PTES

**************************************
**END type1535.dck
**************************************
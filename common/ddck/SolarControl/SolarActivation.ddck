***************************************************
**Solar controller
**************************************************

***************************************************************************
** This controller rules the activation of the primary and secondary loop pump
** of the solar collectors:
**      Primary loop: minimum radiation and collector outlet not too high.
**      Secondary loop: primary loop and temperature difference.
***************************************************************************


***********************************
** Inputs from other ddcks
***********************************

EQUATIONS #
THigh = $CollTOut
TLow = MAX($TNetReturn, $TTesBottom)
TMon = $CollTOut
Ghi = $IT_H

***********************************
** Outputs to other ddcks
***********************************

EQUATIONS #
PuPriOn = PuPriRad*NOT(PuPriTHigh)  ! Activation of primary loop pump: minimum radiation and collector outlet not too high
PuSecOn = PuPriOn*puColSecTemp      ! Activation of secondary loop pump: primary loop pump and temperature difference

***********************************
** Primary loop pump
***********************************

EQUATIONS #
TCollMax = 150
GhiMin = 100
PuPriRad = GT(Ghi, GhiMin)             ! Minimum radiation
PuPriTHigh = GT(TMon, TCollMax)         ! Collector outlet not to high

***********************************
** Secondary loop pump
***********************************

CONSTANTS #
DtOn = 15       ! Upper dead band collector pump ON
DtOff = -10     ! Upper dead band collector pump OFF
TMonMax = 999   ! Maximum monitored temperature

UNIT 55 TYPE 2
PARAMETERS 2
5               ! 1 No. of oscillations
TMonMax         ! 2 High limit cut-out
INPUTS 6
THigh           ! 1 Upper input temperature Th
TLow            ! 2 Lower input temperature Tl
TMon            ! 3 Monitoring temperature Tin
PuColSecTemp    ! 4 70,1 Input control function
!puColOnPri      ! 4 70,1 Input control function
DtOn            ! 5 Upper dead band dT
DtOff           ! 6 Lower dead band dT
0.0 20.0 0.0 0 DtOn DtOff

EQUATIONS #
PuColSecTemp = [55,1] ! Temperature difference

*************************************
********** Online Plotter ***********
*************************************

UNIT 501 TYPE 65     ! Online Plotter HX
PARAMETERS 12
#                   ! 1 Nb. of left-axis variables
#                   ! 2 Nb. of right-axis variables
0                   ! 3 Left axis minimum
200                 ! 4 Left axis maximum -
0                   ! 5 Right axis minimum
2                   ! 6 Right axis maximum
$nPlotsPerSim       ! 7 Number of plots per simulation
12                  ! 8 X-axis gridpoints
1                   ! 9 Shut off Online w/o removing
-1                  ! 10 Logical unit for output file
0                   ! 11 Output file units
0                   ! 12 Output file delimiter
INPUTS #
THigh TLow TMon TMonMax GhiMin | PuPriOn PuSecOn
THigh TLow TMon TMonMax GhiMin | PuPriOn PuSecOn
LABELS  3
Temperatures
MassFlows
Solar_control


